!function(t){var i=function(t,i,e,h,s){this._id=t.id,this._events=e,this._properties={},this._data=[],this._children=[],this._objects=null,this._links=[],this.dx=h,this.dy=s,this.x=h,this.y=s,this.width=0,this.height=0;for(var n=0;n<i.length;n++){var r=i[n];0===n&&"rect"===r.type?(this.x+=r.width/2,this.y+=r.height/2,this.width=r.width,this.height=r.height):0===n&&"circle"===r.type?(this.x+=r.r,this.y+=r.r,this.width=2*r.r,this.height=2*r.r):0===n&&"path"===r.type;var o={};for(var d in r)if("object"==typeof r[d]){var a=r[d][0];if(a in t)o[d]=t[a];else{if(!(r[d].length>1))throw a;o[d]=r[d][1]["default"]}this._properties[a]={name:d,index:n}}else o[d]=r[d];this._data.push(o)}};i.prototype.addChild=function(t){this._children.push(t)},i.prototype.render=function(t,i,e){for(var h=i+this.x+this.width/2,s=e+this.y,n=0;n<this._children.length;n++){var r,o=this._children[n],d=i+o.x-this.width/2,a=e+o.y;if(s==a)r=t.path("M"+h+","+s+"H"+d);else{var p=(d+h)/2;r=t.path("M"+h+","+s+"H"+p+"V"+a+"H"+d)}r.attr("stroke-width",2),r.attr("arrow-end","classic"),this._links.push(r)}this._objects=t.add(this._data);var _=this;this._objects.forEach(function(t){t.translate(i+_.dx,e+_.dy)});for(var l in this._events)"click"==l&&this._objects.click(function(){_._events.click(_._id)})},i.prototype.update=function(t){if(null!=this._objects)for(var i in t)if(i in this._properties){var e=this._properties[i];this._objects[e.index].attr(e.name,t[i])}};var e=function(t,e){if(this._nodes={},this._edges=[],this._paper=null,this._width=800,this._height=600,this._nodeTemplate=[{type:"rect",height:10,width:10,fill:"#FFFFFF"},{type:"text",x:5,y:5,text:["id",{"default":""}]}],!("model"in t))throw"model is mandatory in Graph";"nodeTemplate"in t&&(this._nodeTemplate=t.nodeTemplate);for(var h=0,s=0,n=0;n<t.model.length;n++){var r=t.model[n],o="dx"in r?r.dx:0,d="dy"in r?r.dy:0;h=o>h?o:h,s=d>s?d:s,this._nodes[r.id]=new i(r,this._nodeTemplate,e,o,d),"parent"in r&&r.parent in this._nodes&&this._nodes[r.parent].addChild(this._nodes[r.id])}"rect"==this._nodeTemplate[0].type&&(this._width=this._nodeTemplate[0].width+h,this._height=this._nodeTemplate[0].height+s)};e.prototype.width=function(){return this._width},e.prototype.height=function(){return this._height},e.prototype.onNode=function(t,i){for(var e in this._nodes)this._nodes[e].click(i)},e.prototype.renderTo=function(t){this._paper=Raphael(t,this._width,this._height);for(var i in this._nodes)this._nodes[i].render(this._paper,0,0)},e.prototype.setSize=function(t,i){this._paper.setViewBox(0,0,this._width,this._height,!0),this._paper.setSize(t,i)},e.prototype.update=function(t){if(null!=this._paper){if(!("id"in t))throw t;this._nodes[t.id].update(t)}},t.graph={Tree:function(t,i){return new e(t,i)}}}(window);
